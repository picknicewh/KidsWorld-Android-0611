function loadNew(){setTimeout(function(){var table=document.body.querySelector(".mui-table-view"),data=(document.body.querySelectorAll(".app-mainBox"),{tsId:tsId,groupId:groupId,groupType:groupType,pageNumber:1,pageSize:100,dynamicId:dynamicId,type:2});$.post(url+"/dynamics/getDynamic.do",data,function(response){var u=navigator.userAgent;if(u.indexOf("Android")>-1||u.indexOf("Adr")>-1?showDos.setStatus():u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)&&tooc(),0==response.code&&response.data.length>0){var resultData=response.data;dynamicId=resultData[0].dynamicId;for(var i=resultData.length-1;i>-1;i--){var li=document.createElement("div");li.className="app-mainBox",li.innerHTML=generateHtml(resultData[i]),table.insertBefore(li,table.firstChild)}}}),mui("#pullrefresh").pullRefresh().endPulldownToRefresh()},1500)}function pulldownRefresh(){firstTime=(new Date).Format("yyyy-MM-dd hh:mm:ss"),pageIndex=1;var u=navigator.userAgent;u.indexOf("Android")>-1||u.indexOf("Adr")>-1?showDos.setStatus():u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)&&tooc(),setTimeout(function(){var table=document.body.querySelector(".mui-table-view"),data=(document.body.querySelectorAll(".app-mainBox"),{tsId:tsId,groupId:groupId,groupType:groupType,pageNumber:pageIndex,pageSize:pageSize,createTime:firstTime,type:1});$.post(url+"/dynamics/getDynamic.do",data,function(response){if(0==response.code&&response.data.length>0){table.innerHTML="";var resultData=response.data,dataLen=resultData.length;dynamicId=resultData[0].dynamicId;for(var i=0;i<dataLen;i++){var li=document.createElement("div");li.className="app-mainBox",li.innerHTML=generateHtml(resultData[i]),table.appendChild(li)}}}),pageIndex=2,mui("#pullrefresh").pullRefresh().endPulldownToRefresh()},1500)}function pullupRefresh(){setTimeout(function(){mui("#pullrefresh").pullRefresh().endPullupToRefresh(!pageflag);var table=document.body.querySelector(".mui-table-view"),data=(document.body.querySelectorAll(".app-mainBox"),{tsId:tsId,groupId:groupId,groupType:groupType,pageNumber:pageIndex,pageSize:pageSize,createTime:firstTime,type:1});$.post(url+"/dynamics/getDynamic.do",data,function(response){if("0"==response.code)if(0==response.data.length&&1==pageIndex)mui.toast("暂无数据");else{var resultData=response.data,dataLen=resultData.length;dataLen!=pageSize&&(pageflag=!1),dynamicId=resultData[0].dynamicId;for(var i=0;i<dataLen;i++){var li=document.createElement("div");li.className="app-mainBox",li.innerHTML=generateHtml(resultData[i]),table.appendChild(li)}}}),pageIndex++},1500)}function generateHtml(arr){var tmpHtml="",names=[];if(tmpHtml+='<div class="app-leftIn"><div class="app-photo">',tmpHtml+=1==arr.tsType?"<img src="+arr.img+'><span class="mui-badge mui-badge-danger app-badge">学</span>':"<img src="+arr.img+'><span class="mui-badge mui-badge-danger app-badge back-green">师</span>',tmpHtml+='</div></div><div class="app-rigthIn"><div class="app-name">'+arr.tsName+'</div><div class="app-content">',tmpHtml+='<div class="text">'+arr.text+"</div>",1==arr.dynamicType&&0!=arr.imgUrl.length){var imgHtml="",imgArr=arr.imgUrl,imgLen=imgArr.length;if(1==imgLen)imgHtml+='<li><img src="'+imgArr[0]+'" class="oneImg" data-preview-src="'+imgArr[0].replace(/\/s/,"")+'" data-preview-group="'+imgIndex+'"/></li>';else for(var j=0;j<imgLen;j++)imgHtml+='<li><img src="'+imgArr[j]+'" data-preview-src="'+imgArr[j].replace(/\/s/,"")+'" data-preview-group="'+imgIndex+'"/></li>';tmpHtml+='<ul class="image2">'+imgHtml+"</ul>",imgIndex++}if(tmpHtml+="</div>",tmpHtml+='<div class="app-control" data-islike='+arr.isAgree+" data-likecnt="+arr.list.length,tmpHtml+=" data-dynamicid="+arr.dynamicId+'><span class="app-time">',tmpHtml+='<span class="app-time">'+arr.date+"</span>",tmpHtml+='</span><span class="mui-pull-right" id="more"><img src="../images/more.png"  style="width:20px;"/></span>',tmpHtml+='<a  class="item dy_like_btn_v3 popup" id="popup" href="javascript:;" data-show="0" style="display: none;">',tmpHtml+='<img src="../images/heart.png"/><span id="thumb">'+(2==arr.isAgree?"赞":"取消")+"</span></a></div>",0!=arr.list.length){names=arr.list,tmpHtml+='<div class="names" id="names"><span class="top"></span><img src="../images/lightHeart.png" width="20px" height="18px">';for(var n=0,namesLen=names.length;n<namesLen;n++)tmpHtml+='<span class="name" value='+names[n]+">"+names[n]+"</span>"}else tmpHtml+='<div class="names" id="names" hidden><span class="top"></span><img src="../images/lightHeart.png" width="20px" height="18px">';return tmpHtml+="</div></div></div>"}function getQueryString(name){var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)","i"),r=window.location.search.substr(1).match(reg);return null!=r?decodeURIComponent(r[2]):null}function ISODateString(d){function pad(n){return n<10?"0"+n:n}return d.getUTCFullYear()+"-"+pad(d.getUTCMonth()+1)+"-"+pad(d.getUTCDate())+"T"+pad(d.getUTCHours())+":"+pad(d.getUTCMinutes())+":"+pad(d.getUTCSeconds())+"Z"}var url="http://eduslb.openhunme.com/KidsWorld",imgIndex=2,tsId=getQueryString("tsId"),groupId=getQueryString("groupId"),groupType=getQueryString("groupType"),firstTime=getQueryString("clickTime"),dynamicId=null,myName=getQueryString("myName");$(".mui-scroll").on("tap","#more",function(event){var $this=$(this),drop=$this.next().data("show");0==drop?($("[id=popup]").data("show",0).hide(),$this.next().data("show",1).show()):$this.next().data("show",0).hide(),$(document).one("tap",function(){$("[id=popup]").data("show",0).hide()}),event.stopPropagation()}),$(".mui-scroll").on("tap","#popup",function(event){var $this=$(this),likecnt=$this.parent().data("likecnt"),islike=$this.parent().data("islike"),dynamicIds=$this.parent().data("dynamicid"),dataz={tsId:tsId,dynamicId:dynamicIds,cancel:1},dataq={tsId:tsId,dynamicId:dynamicIds,cancel:2};1==islike&&1==likecnt?($this.parent().siblings("div#names").children("span[value="+myName+"]").remove(),$this.data("show",0).hide(),$this.parent().siblings("div#names").hide(),$this.children("span#thumb").text("赞"),$this.parent().data("islike",2),$this.parent().data("likecnt",likecnt-1),$.post(url+"/dynamic/subPraise.do",dataq,function(response){})):2==islike&&0==likecnt?($this.parent().data("islike",1),$this.parent().data("likecnt",likecnt+1),$this.children("span#thumb").text("取消"),$this.parent().siblings("div#names").append('<span class="name" value='+myName+">"+myName+"</span>"),$this.parent().siblings("div#names").show(),$this.data("show",0).hide(),$.post(url+"/dynamics/subPraise.do",dataz,function(response){})):1==islike?($this.parent().siblings("div#names").children("span[value="+myName+"]").remove(),$this.data("show",0).hide(),$this.children("span#thumb").text("赞"),$this.parent().data("islike",2),$this.parent().data("likecnt",likecnt-1),$.post(url+"/dynamics/subPraise.do",dataq,function(response){})):($this.parent().data("islike",1),$this.parent().data("likecnt",likecnt+1),$this.children("span#thumb").text("取消"),$this.parent().siblings("div#names").append('<span class="name" value='+myName+">"+myName+"</span>"),$this.data("show",0).hide(),$.post(url+"/dynamics/subPraise.do",dataz,function(response){}))}),mui.previewImage();var pageflag=!0,pageIndex=1,pageSize=15;mui.init({pullRefresh:{container:"#pullrefresh",down:{callback:pulldownRefresh},up:{contentrefresh:"正在加载...",callback:pullupRefresh}}}),Date.prototype.Format=function(fmt){var o={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(fmt)&&(fmt=fmt.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var k in o)new RegExp("("+k+")").test(fmt)&&(fmt=fmt.replace(RegExp.$1,1==RegExp.$1.length?o[k]:("00"+o[k]).substr((""+o[k]).length)));return fmt},function(doc,win){var docEl=doc.documentElement||doc.body,resizeEvt="orientationchange"in window?"orientationchange":"resize",recalc=function(){var clientWidth=docEl.clientWidth;clientWidth&&(docEl.style.fontSize=20*(clientWidth/320)+"px",docEl.style.display="block")};docEl.style.display="none",doc.addEventListener&&(win.addEventListener(resizeEvt,recalc,!1),doc.addEventListener("DOMContentLoaded",recalc,!1))}(document,window),mui.os.plus?mui.plusReady(function(){setTimeout(function(){mui("#pullrefresh").pullRefresh().pullupLoading()},1e3)}):mui.ready(function(){mui("#pullrefresh").pullRefresh().pullupLoading()});