"use strict";angular.module("app",["ui.router","ngAnimate","ionic"]).constant("BASE_URL","http://www.hongzhang.net.cn/KidsWorld").run(function($rootScope){function onDeviceReady(){}$rootScope.flag=!0,$rootScope.$on("$stateChangeStart",function(event,next){}),document.addEventListener("deviceready",onDeviceReady,!1)}).filter("numberTo4",function(){return function(input){if(input){if(input>=1e3){var newNum=(input/1e4).toFixed(1);return newNum+"万"}return input}return 0}}).filter("timeToMinute",function(){return function(inputs){return inputs?inputs.substring(5,16):""}}).factory("CommonService",function(){return{showAlert:{cfg:{id:".kBubble",speed:2e3},show:function(str){var oBubble=$(this.cfg.id);oBubble.length||(oBubble=$('<div class="kBubble" />').appendTo($("body")),oBubble.html(str).fadeIn()),setTimeout("$('.kBubble').fadeOut('slow',function(){$('.kBubble').remove();})",this.cfg.speed)}}}}).factory("AjaxService",function($http,$httpParamSerializerJQLike,$q,$ionicLoading,CommonService,BASE_URL,$rootScope){return{ajax:function(options){var url=options.url;options.useBaseUrl&&(url=BASE_URL+options.url);var httpOption={method:options.type||"post",url:url};if("post"==httpOption.method)httpOption.data=options.data||{};else{var pString=$httpParamSerializerJQLike(options.data||{});httpOption.url+=pString?"?"+pString:""}var deferred=$q.defer();return"post"==httpOption.method?$.ajax({type:"post",url:httpOption.url,data:httpOption.data,dataType:"json",success:function(data){return data.code==-9?void CommonService.showAlert.show("系统繁忙"):void deferred.resolve({data:data})},error:function(data){CommonService.showAlert.show("网络异常"),$rootScope.$broadcast("ajaxError"),deferred.reject(data),$rootScope.flag=!1}}):$http(httpOption).success(function(data){return data.code==-9?void CommonService.showAlert.show("系统繁忙"):void deferred.resolve({data:data})}).error(function(data){CommonService.showAlert.show("网络异常"),$rootScope.$broadcast("ajaxError"),deferred.reject(data),$rootScope.flag=!1}),{$promise:deferred.promise}}}}).factory("WebService",function(AjaxService){return{getResourceDetail:function(tsId,resourceid){var options={};return options.type="post",options.useBaseUrl=!0,options.url="/rakuen/getDetails.do",options.data={tsId:tsId,resourceId:resourceid,account_id:accountIdLogin},AjaxService.ajax(options)},subComment:function(resourceid,tsId,content){var options={};return options.type="post",options.useBaseUrl=!0,options.url="/rakuen/subComment",options.data={resourceid:resourceid,tsId:tsId,content:content},AjaxService.ajax(options)},getCommentList:function(resourceid,pageSize,pageNumber){var options={};return options.type="post",options.useBaseUrl=!0,options.url="/rakuen/getCommentList.do",options.data={resourceid:resourceid,pageSize:pageSize,pageNumber:pageNumber},AjaxService.ajax(options)},getTsInfo:function(tsId){var options={};return options.type="post",options.useBaseUrl=!0,options.url="/message/getTS.do",options.data={tsId:tsId},AjaxService.ajax(options)},savePlayTheRecordingBegin:function(tsId,resourceid){var options={};return options.type="post",options.useBaseUrl=!0,options.url="/rakuen/savePlayTheRecording.do",options.data={tsId:tsId,resourceid:resourceid,type:1},AjaxService.ajax(options)},savePlayTheRecordingProgress:function(tsId,resourceid,broadcastPace){var options={};return options.type="post",options.useBaseUrl=!0,options.url="/rakuen/savePlayTheRecording.do",options.data={tsId:tsId,resourceid:resourceid,type:2,broadcastPace:broadcastPace},AjaxService.ajax(options)},saveResourceFavorites:function(tsId,albumId,type){var options={};return options.type="post",options.useBaseUrl=!0,options.url="/rakuen/saveResourceFavorites.do",options.data={tsId:tsId,albumId:albumId,type:type},AjaxService.ajax(options)}}}).controller("EduInformationCtrl",function($scope,$state,$stateParams,$ionicHistory,$ionicScrollDelegate,CommonService,WebService){$scope.resourceid=getUrlParam("resourceid"),$scope.doRefresh=function(){window.location.reload()},$scope.init=function(){var res=WebService.getResourceDetail(tsIdLogin,$scope.resourceid);res.$promise.then(function(response){var data=response.data.data;if(!data)return void CommonService.showAlert.show("无资讯数据！");$scope.displayInfName=data.resourceName,$scope.displayInfCnt=data.content,$scope.displaySource=data.author,$scope.displayCreatetime=data.createTime,1==data.isFavorites?$scope.storeActive=!0:$scope.storeActive=!1;var resPlayHis=WebService.savePlayTheRecordingBegin(tsIdLogin,$scope.resourceid);resPlayHis.$promise.then(function(response){var data=response.data;console.log(data.data)})}),$scope.currentUser={},$scope.getTsInfo=function(){var res=WebService.getTsInfo(tsIdLogin);res.$promise.then(function(response){var data=response.data;0==data.code?$scope.currentUser=data.data:CommonService.showAlert.show(data.data)})},$scope.getTsInfo(),$scope.items_comment=[],$scope.pageNumber=1,$scope.loadState=0,$scope.loadDataByPageNumber=function(pageNumber){var res=WebService.getCommentList($scope.resourceid,20,pageNumber);$scope.loadState=1,res.$promise.then(function(response){var data=response.data.data,length=data.length;$scope.loadState=0,length<20&&($scope.loadState=2,length<=0)||($scope.items_comment=$scope.items_comment.concat(data),$ionicScrollDelegate.resize())})},$scope.loadDataByPageNumber($scope.pageNumber)},$scope.init(),$scope.store=function(){if($scope.storeActive)var cancel=2;else var cancel=1;var res=WebService.saveResourceFavorites(tsIdLogin,$scope.resourceid,cancel);res.$promise.then(function(response){var data=response.data;0==data.code?$scope.storeActive?($scope.storeActive=!1,data.isFavorites=2,CommonService.showAlert.show("取消收藏"+data.data)):($scope.storeActive=!0,data.isFavorites=1,CommonService.showAlert.show("收藏"+data.data)):CommonService.showAlert.show(data.data)})},$scope.subComment=function(commentWord){var str=$(".inputBox input").attr("value").trim();if(""==str)CommonService.showAlert.show("内容不能为空");else{var res=WebService.subComment($scope.resourceid,tsIdLogin,commentWord);res.$promise.then(function(response){var data=response.data;if(0==data.code){CommonService.showAlert.show(data.data);var tempComment={tsImgurl:$scope.currentUser.img,tsType:$scope.currentUser.tsType,tsName:$scope.currentUser.tsName,date:"刚刚",content:commentWord};$scope.items_comment.unshift(tempComment),$scope.commentWord=null,$(".inputBox input").val("")}else CommonService.showAlert.show(data.data)})}},$scope.loadMoreData=function(){$scope.pageNumber=$scope.pageNumber+1,$scope.loadDataByPageNumber($scope.pageNumber)},$scope.scrollToUp=function(){$scope.positionOrigin=$(".InfDetContent.eduInf>.scroll").css("transform");var hight=$(".InfDetContent.eduInf .InfDetContent").height()+160,toUp="translate3d( 0px,-"+hight+"px,0 ) scale( 1 )";$(".InfDetContent.eduInf>.scroll").css("transform",toUp)},$scope.scrollBack=function(){$(".InfDetContent.eduInf>.scroll").css("transform",$scope.positionOrigin)}});