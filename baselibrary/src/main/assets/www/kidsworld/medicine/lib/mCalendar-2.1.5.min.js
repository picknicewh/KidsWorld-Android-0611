/*
versionï¼šv2.1.5
update:2016-01-25
*/
(function(d){var g="ontouchstart"in d?"touchstart":"click",n="ontouchstart"in d?"touchstart":"mousedown",p="ontouchmove"in d?"touchmove":"mousemove",r="ontouchend"in d?"touchend":"mouseup",k=d.requestAnimationFrame||d.webkitRequestAnimationFrame,q=d.cancelAnimationFrame||d.webkitCancelAnimationFrame,t="transform"in document.createElement("div").style?"transform":"webkitTransform";d.mCalendar=function(b){var a=this;if(b){if(b.setDate){a.getDate=b.setDate;var e=b.setDate.substr(0,4),c=parseInt(b.setDate.substr(5,
2))-1,d=b.setDate.substr(8,2);a.Date=new Date(e,10>c?"0"+c:c,d);a.today={day:a.Date.getDay(),date:a.Date.getDate(),month:a.Date.getMonth(),year:a.Date.getFullYear()}}b.toBind&&b.toBind.addEventListener(n,function(b){a.open();b.preventDefault()});b.multiple&&(a.multiple=!0);b.callback&&"function"==typeof b.callback&&(a.hasCallback=!0,a.callback=b.callback)}a.handlerStart=Date.now();a.currentIndex=a.preIndex=1;a.startX=0;a.endX=0;a.layout();a.countbox=a.byClass(a.calendar,"countbox");a.tables=a.byTag(a.dategroup,
"table");a.yearArrows_l=a.byClass(a.countbox[0],"l-arrows")[0];a.yearArrows_r=a.byClass(a.countbox[0],"r-arrows")[0];a.dateArrows_l=a.byClass(a.countbox[1],"l-arrows")[0];a.dateArrows_r=a.byClass(a.countbox[1],"r-arrows")[0];a.yearNum=a.byClass(a.calendar,"count-number")[0];a.monthNum=a.byClass(a.calendar,"count-number")[1];a.cancelBtn=a.byClass(a.calendar,"cancel-btn")[0];a.finishBtn=a.byClass(a.calendar,"finish-btn")[0];a.currentDate={date:a.today.date,day:a.today.day,month:a.today.month,year:a.today.year};
a.outputDate="";a.init()};d.mCalendar.prototype.byClass=function(b,a){return b.getElementsByClassName(a)};d.mCalendar.prototype.byTag=function(b,a){return b.getElementsByTagName(a)};d.mCalendar.prototype.htmlStrJson={header:'<div class="countbox"><span class="l-arrows">&lt;</span><span class="count-number">2000\u5e74</span><span class="r-arrows">&gt;</span></div><div class="countbox"><span class="l-arrows">&lt;</span><span class="count-number">00\u6708</span><span class="r-arrows">&gt;</span></div><div class="btn-item"><span class="btn cancel-btn">\u53d6\u6d88</span><span class="btn finish-btn">\u5b8c\u6210</span></div>',
dayHeader:"<thead><tr><th>\u65e5</th><th>\u4e00</th><th>\u4e8c</th><th>\u4e09</th><th>\u56db</th><th>\u4e94</th><th>\u516d</th></tr></thead>"};d.mCalendar.prototype.createElement=function(b,a){var e=document.createElement(b);a.className&&this.addClass(e,a.className);a.appendToEl.appendChild(e);return e};d.mCalendar.prototype.hasClass=function(b,a){a=a||"";return 0==a.replace(/\s/g,"").length?!1:(new RegExp(" "+a+" ")).test(" "+b.className+" ")};d.mCalendar.prototype.addClass=function(b,a){d.mCalendar.prototype.hasClass(b,
a)||(b.className+=" "+a)};d.mCalendar.prototype.removeClass=function(b,a){if(d.mCalendar.prototype.hasClass(b,a)){for(var e=" "+b.className.replace(/[\t\r\n]/g,"")+" ";0<=e.indexOf(" "+a+" ");)e=e.replace(" "+a+" "," ");b.className=e.replace(/^\s+|\s+$/g,"")}};d.mCalendar.prototype.close=function(b){b=b||this;b.addClass(b.calendar,"calendar-hide")};d.mCalendar.prototype.open=function(b){b=b||this;b.removeClass(b.calendar,"calendar-hide")};d.mCalendar.prototype.dates=[];d.mCalendar.prototype.months=
[];d.mCalendar.prototype.Date=new Date;d.mCalendar.prototype.today={day:d.mCalendar.prototype.Date.getDay(),date:d.mCalendar.prototype.Date.getDate(),month:d.mCalendar.prototype.Date.getMonth(),year:d.mCalendar.prototype.Date.getFullYear()};d.mCalendar.prototype.tablelength=3;d.mCalendar.prototype.rows=6;d.mCalendar.prototype.cols=7;d.mCalendar.prototype.tdslengh=42;d.mCalendar.prototype.layout=function(){var b=this.createElement("div",{appendToEl:document.body,className:"calendar"});this.createElement("div",
{appendToEl:b,className:"mask"});var a=this.createElement("div",{appendToEl:b,className:"container"}),e=this.createElement("div",{appendToEl:a,className:"calendar-header"}),a=this.createElement("div",{appendToEl:a,className:"calendar-body"}),c=this.createElement("div",{appendToEl:a,className:"week-header"}),c=this.createElement("table",{appendToEl:c}),a=this.createElement("div",{appendToEl:a,className:"date-group"});e.innerHTML=this.htmlStrJson.header;c.innerHTML=this.htmlStrJson.dayHeader;this.calendar=
b;this.dategroup=a;this.addClass(this.calendar,"calendar-hide");b=this.width=this.calendar.offsetWidth;for(e=0;e<this.tablelength;e++){for(var c=this.createElement("table",{appendToEl:a}),d=this.createElement("tbody",{appendToEl:c}),l=0;l<this.rows;l++)for(var h=this.createElement("tr",{appendToEl:d}),f=0;f<this.cols;f++)this.createElement("td",{appendToEl:h});this.translateX(c,-b+b*e)}};d.mCalendar.prototype.switchDate=function(b,a,e){e=e||250;var c=this;if(!(Date.now()-c.handlerStart<e)){c.endX+=
c.width*b;c.currentDate[a]+=-1*b;0>c.currentDate.month?(--c.currentDate.year,c.currentDate.month=11):11<c.currentDate.month&&(c.currentDate.year+=1,c.currentDate.month=0);c.currentIndex+=-1*b;c.currentIndex>c.tablelength-1?c.currentIndex=0:0>c.currentIndex&&(c.currentIndex=c.tablelength-1);c.tables[c.preIndex].removeAttribute("aria-show");c.tables[c.currentIndex].setAttribute("aria-show","true");if(-1===b)var d=c.currentIndex+1>c.tablelength-1?0:c.currentIndex+1;else 1===b&&(d=0>c.currentIndex-1?
c.tablelength-1:c.currentIndex-1);c.translateX(c.tables[c.preIndex],-c.endX+c.width*b);c.translateX(c.tables[d],-c.endX+c.width*b*-1);c.translateX(c.tables[c.currentIndex],-c.endX);"year"===a?(c.drawDate(c.tables[c.preIndex],c.currentDate.year- -1*b,c.currentDate.month),c.drawDate(c.tables[d],c.currentDate.year+-1*b,c.currentDate.month)):"month"===a&&(c.drawDate(c.tables[c.preIndex],c.currentDate.year,c.currentDate.month- -1*b),c.drawDate(c.tables[d],c.currentDate.year,c.currentDate.month+-1*b));
c.drawDate(c.tables[c.currentIndex],c.currentDate.year,c.currentDate.month);c.scrollX({endX:c.endX,duration:e,callback:function(){c.startX=c.endX}});c.update();c.preIndex=c.currentIndex;c.handlerStart=Date.now()}};d.mCalendar.prototype.select=function(){var b=this;b.bindselect=function(a){if((a=a.target.parentElement)&&"td"==a.nodeName.toLowerCase()){var e=a.getAttribute("aria-date");if(b.multiple)b.hasClass(a,"active")&&b.selectedDates[e]?(b.removeClass(a,"active"),b.selectedDates[e]=null):(b.addClass(a,
"active"),b.selectedDates[e]=e);else{for(var c=0;c<this.tdsAllLen;c++)b.removeClass(b.alltds[c],"active");b.addClass(a,"active");b.selectedDates.single=e}}}};d.mCalendar.prototype.translateX=function(b,a){b.style[t]="translate3d("+a+"px,0,0)"};d.mCalendar.prototype.scrollX=function(b){function a(){1<=f/h?(k?q(e.timer):clearTimeout(e.timer),e.timer=null,b.callback&&b.callback()):(f=Math.min(h,Date.now()-m),c=d+(l-d)/h*f,e.startX=c,e.translateX(e.dategroup,c),e.timer=k?k(a):setTimeout(a,0))}var e=this;
k?q(e.timer):clearTimeout(e.timer);var c=0,d=e.startX,l=b.endX,h=b.duration||250,f=0,m=Date.now();a()};d.mCalendar.prototype.swipeX=function(){function b(b){var d=b.touches?b.touches[0]:b;touchmoveX=d.pageX;gapX=touchmoveX-e;c=touchmoveX>moveendX?1:-1;moveendX&&(a.startX+=touchmoveX-moveendX);a.translateX(a.dategroup,a.startX);moveendX=d.pageX;b.preventDefault()}var a=this,e=touchmoveX=moveendX=gapX=0,c=0;a.dategroup.addEventListener(n,function(c){e=(c.touches?c.touches[0]:c).pageX;a.calendar.addEventListener(p,
b,!1);c.preventDefault()},!1);a.calendar.addEventListener(r,function(d){10<Math.abs(gapX)?a.switchDate(c,"month"):(0==Math.abs(gapX)&&a.bindselect(d),0<Math.abs(gapX)&&!a.hasClass(d.target,"l-arrows")&&!a.hasClass(d.target,"r-arrows")&&a.scrollX({endX:a.endX,duration:200,callback:function(){a.startX=a.endX}}));a.calendar.removeEventListener(p,b);e=touchmoveX=moveendX=gapX=0})};d.mCalendar.prototype.drawDate=function(b,a,e){b=this.byTag(b,"tbody")[0];0>e?(--a,e=11):11<e&&(a+=1,e=0);for(var c=1,d=(new Date(a,
e+1,0)).getDate(),l=(new Date(a,e,1)).getDay(),h=(new Date(a,e,0)).getDate()-l+1,f=1,m="",g=[],k=0;k<this.tdslengh;k++)k<l?(g.push("<td class='mendDay' aria-date="+(0>e-1?a-1:a)+"-"+this.months[0>e-1?11:e-1]+"-"+this.dates[h-1]+"><div>"+h+"</div></td>"),h++):c>d?(g.push("<td class='mendDay' aria-date="+(11<e+1?a+1:a)+"-"+this.months[11<e+1?0:e+1]+"-"+this.dates[f-1]+"><div>"+f+"</div></td>"),f++):(g.push("<td aria-date="+a+"-"+this.months[e]+"-"+this.dates[c-1]+"><div>"+c+"</div></td>"),c++);for(a=
0;a<this.rows;a++){e="";for(c=a*this.cols;c<a*this.cols+this.cols;c++)e+=g[c];m+="<tr>"+e+"</tr>"}b.innerHTML=m};d.mCalendar.prototype.update=function(){this.yearNum.innerHTML=this.currentDate.year+"\u5e74";this.monthNum.innerHTML=1==String(this.currentDate.month+1).length?"0"+(this.currentDate.month+1)+"\u6708":this.currentDate.month+1+"\u6708";for(var b=0;b<this.tdsAllLen;b++)for(var a in this.selectedDates)this.alltds[b].getAttribute("aria-date")==this.selectedDates[a]&&this.addClass(this.alltds[b],
"active")};d.mCalendar.prototype.init=function(){for(var b=this,a=1;31>=a;a++)10>a&&(a="0"+a),a=String(a),d.mCalendar.prototype.dates.push(a);for(a=1;12>=a;a++)10>a&&(a="0"+a),a=String(a),d.mCalendar.prototype.months.push(a);b.alltds=b.byTag(b.calendar,"td");b.tdsAllLen=b.alltds.length;b.ariaToday=b.today.year+"-"+b.months[b.today.month]+"-"+b.dates[this.today.date-1];b.selectedDates={};b.multiple?b.selectedDates[b.ariaToday]=b.ariaToday:b.selectedDates.single=b.ariaToday;b.translateX(b.dategroup,
b.startX);b.swipeX();b.dategroup.style.height=b.byTag(b.dategroup,"tbody")[0].offsetHeight+"px";for(a=0;a<b.tablelength;a++)b.drawDate(b.tables[a],b.currentDate.year,b.currentDate.month-1+a);b.tables[1].setAttribute("aria-show","true");b.update();b.dateArrows_l.addEventListener(g,function(){b.switchDate(1,"month")},!1);b.dateArrows_r.addEventListener(g,function(){b.switchDate(-1,"month")},!1);b.yearArrows_l.addEventListener(g,function(){b.switchDate(1,"year")},!1);b.yearArrows_r.addEventListener(g,
function(){b.switchDate(-1,"year")},!1);b.select();b.cancelBtn.addEventListener("click",function(){b.close(b)},!1);b.finishBtn.addEventListener("click",function(){b.close(b);var a=[],c;for(c in b.selectedDates)b.selectedDates[c]&&a.push(b.selectedDates[c]);b.outputDate=1==a.length?a:a.sort().join();b.hasCallback&&b.callback()},!1)}})(window);